# HackShop 仿真商城漏洞靶场 - 产品需求文档（PRD）

| 项目 | 内容 |
|---|---|
| 文档版本 | v4.1 |
| 创建日期 | 2025-09-28 |
| 最后更新 | 2026-02-20 |
| 文档状态 | 与当前代码实现对齐 |

## 1. 产品概述
- 产品类型：业务驱动式 Web 安全教学靶场
- 核心目标：在真实电商流程中进行漏洞学习与复现
- 用户角色：普通用户、管理员

## 2. 功能范围
- 用户认证：注册、登录、找回密码、重置密码
- 商城流程：商品浏览、购物车、下单、支付、订单详情
- 用户中心：地址管理、资产查询、储值券兑换
- 管理后台：商品管理、订单管理、用户管理、储值券、批量导入
- 仿真辅助：模拟收件箱、初始化页面 `/setup`

## 3. 漏洞范围（10个）
| 漏洞ID | 名称 | 状态 |
|---|---|---|
| V-Auth-DoS | 认证拒绝服务 | 已实现 |
| V-Host-Inject | Host 头注入 | 已实现 |
| V-CSRF-Pay | 支付 CSRF | 已实现 |
| V-Race-Condition | 储值券兑换竞态 / 支付扣减竞态 | 已实现 |
| V-IDOR-View | 越权查看订单 | 已实现 |
| V-IDOR-Modify | 越权修改地址 | 已实现 |
| V-SSRF | 后台导入 SSRF | 已实现 |
| V-SQL-Union | SQL 注入（订单详情） | 已实现 |
| V-SSTI | 模板注入（订单详情） | 已实现 |
| V-Admin-AES | 管理员 AES 密钥泄露 | 已实现 |

> 注：漏洞为教学目的刻意保留，不属于常规缺陷修复范围。

## 4. 质量范围说明（当前）
- 已按 SonarQube 方向完成一轮非安全项治理
- 代码异味（Code Smells）与部分可靠性问题已清理
- 页面交互与错误反馈文案已统一规范
- 靶场漏洞与教学链路保持不变

## 5. 技术架构
- Flask + Blueprint 模块化
- MySQL + SQLAlchemy + Flask-Migrate
- Redis 缓存
- Docker Compose（三服务）
- Gunicorn 运行

## 6. 工程化能力（当前）
- 容器健康检查：mysql / redis / web
- MySQL 持久化卷：`mysql_data`
- 启动迁移策略：`db upgrade` + `stamp head` fallback
- 日志：控制台 + 轮转文件（`logs/app.log`）
- 实验脚本：`scripts/seed.py`、`scripts/reset_lab.py`
- 默认种子账号：`admin/admin123`、`alice@test.com/alice123`

## 7. 验收标准
- `docker compose up -d --build` 后可访问 `127.0.0.1:8000`
- `/setup` 可完成初始化
- 管理后台关键路径可访问并可操作
- 10 个漏洞可在授权环境复现
- 关键页面交互提示与错误提示可正常显示

## 8. 文档历史
- v4.1（2026-02-20）：补充种子账号口径并与容器运行方式保持一致
- v4.0（2026-02-20）：删除特定措辞，统一按当前代码状态描述质量治理范围
- v3.9（2026-02-20）：同步代码质量治理范围说明
